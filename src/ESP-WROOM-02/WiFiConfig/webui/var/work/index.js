!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i.r(e);var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=e,this.d=this.w.document,this.events=[],this.ap=[]}var e,i,n;return e=t,(i=[{key:"id",value:function(t){return this.d.getElementById(t)}},{key:"click",value:function(t,e){var i=this.id(t);i.addEventListener("click",e),this.events.push([i,"click",e])}},{key:"clear_events",value:function(){for(var t in this.events){var e=this.events[t];e[0].removeEventListener(e[1],e[2])}this.events=[]}},{key:"show",value:function(t){this.id(t).style.display="block"}},{key:"hide",value:function(t){this.id(t).style.display="none"}},{key:"fetch_json",value:function(t,e){return new Promise((function(i,s){var n=new XMLHttpRequest;if(e?(console.log("Fetch(POST): ",t),n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")):(console.log("Fetch(GET): ",t),n.open("GET",t,!0)),n.onload=function(){this.status>=200&&this.status<400?i(JSON.parse(this.response)):(console.log(this),s())},e){var a=[];for(var o in e){var r=e[o],d=encodeURIComponent(o)+"="+encodeURIComponent(r);a.push(d)}var _=a.join("&").replace(/%20/g,"+");console.log(_),n.send(_)}else n.send()}))}},{key:"run",value:function(){console.log("Index.run"),this.fetch_ap_list()}},{key:"reset_disp_ap",value:function(){this.hide("d_ap_list"),this.hide("d_ap_scan_now"),this.hide("d_ap_scan"),this.hide("d_ap_info"),this.show("d_ap"),this.clear_events()}},{key:"fetch_ap_list",value:function(){var t=this;this.reset_disp_ap(),this.fetch_json("/api/ap/list").then((function(e){for(var i in e.data)t.ap[i]={ssid:e.data[i].ssid,passphase:"",update:!1};t.show_ap_list()}))}},{key:"show_ap_list",value:function(){var t=this;this.reset_disp_ap();var e="<tr><td>番号</td><td>SSID</td><td>　</td></tr>",i=!1;for(var s in this.ap){var n=this.ap[s];e=e+"<tr><td>"+(new Number(s)+1)+"</td>"+(n.update?'<td style="background-color:#FFFFAA">':"<td>")+n.ssid+'</td><td><input type="button" id="b_ap_setup_'+s+'" value="設定"></td>',n.update&&(i=!0)}for(var a in this.id("t_ap_list").innerHTML=e,this.ap)!function(e){t.click("b_ap_setup_"+e,(function(i){t.show_ap_info(e)}))}(a);this.click("b_submit",(function(){t.do_submit()})),this.click("b_clear",(function(){t.hide("d_submit"),t.hide("d_submit_warn"),t.fetch_ap_list()})),this.click("b_reset",(function(){t.w.confirm("工場出荷時に戻します。よろしいですか？")&&t.do_reset()})),i&&(this.show("d_submit"),this.show("d_submit_warn")),this.show("d_ap_list")}},{key:"do_submit",value:function(){this.reset_disp_ap(),this.hide("d_submit_warn"),this.show("d_submit_exec");var t={};for(var e in this.ap)t["ssid"+e]=this.ap[e].ssid,t["passphase"+e]=this.ap[e].passphase,t["update"+e]=this.ap[e].update?1:0;this.fetch_json("/api/ap/config",t)}},{key:"do_reset",value:function(){this.reset_disp_ap(),this.hide("d_submit_warn"),this.show("d_reset_exec"),this.fetch_json("/api/ap/reset",{execute_reset:42})}},{key:"show_ap_info",value:function(t){var e=this;this.reset_disp_ap(),this.id("s_ap_info_num").innerHTML=new Number(t)+1,this.id("t_ap_info_ssid").value=this.ap[t].ssid,this.id("t_ap_info_passphase").value=this.ap[t].passphase,this.click("b_ap_info_back",(function(t){e.show_ap_list()})),this.click("b_ap_info_scan",(function(i){e.fetch_ap_scan(t)})),this.click("b_ap_info_commit",(function(i){var s=e.id("t_ap_info_ssid").value,n=e.id("t_ap_info_passphase").value;e.ap[t]={ssid:s,passphase:n,update:!0},e.show_ap_list()})),this.show("d_ap_info")}},{key:"fetch_ap_scan",value:function(t){var e=this;this.reset_disp_ap(),this.id("s_ap_scan_num").innerHTML=new Number(t)+1,this.show("d_ap_scan_now"),this.fetch_json("/api/ap/scan").then((function(i){var s="<tr><td>SSID</td><td>Ch.</td><td>RSSI</td><td></td></tr>";for(var n in i.data.sort((function(t,e){return e.rssi-t.rssi})),i.data){var a=i.data[n];s=s+"<tr><td>"+a.ssid+"</td><td>"+a.channel+"</td><td>"+a.rssi+'dB</td><td><input type="button" id="t_ap_scan_sel_'+n+'" value="選択"></tr>'}for(var o in e.id("t_ap_scan").innerHTML=s,i.data)!function(s){e.click("t_ap_scan_sel_"+s,(function(n){e.ap[t].ssid=i.data[s].ssid,e.ap[t].passphase="",e.show_ap_info(t)}))}(o);e.click("b_ap_scan_back",(function(i){e.show_ap_info(t)})),e.hide("d_ap_scan_now"),e.show("d_ap_scan")}))}}])&&s(e.prototype,i),n&&s(e,n),t}();document.addEventListener("DOMContentLoaded",(function(){new n(window).run()}))}]);