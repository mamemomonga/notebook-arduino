<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">

<title></title>
<meta name="viewport" content="width=800">


<style type="text/css">body{font-size:16px;font-family:sans-serif}.container{max-width:800px;margin:10px auto;padding:40px 80px;border:1px solid #DDDDDD;border-radius:0px}h1{padding:10px;font-size:2rem}h2{padding:10px;font-size:1rem}h3{font-size:0.9rem}h4{font-size:0.8rem}blockquote{background-color:#F4F4F4;padding:5px}table{border-collapse:collapse;margin:20px 0px}table th{border:1px solid #DDDDDD;background-color:#EEEEEE;padding:5px 20px}table td{border:1px solid #DDDDDD;padding:5px 20px}#m_wifi{display:none}#d_ap{display:none}#d_ap_list{display:none}#d_ap_scan{display:none}#d_ap_info{display:none}#d_ap_scan_now{display:none;animation:d_ap_scan_now_a 0.2s infinite alternate}@keyframes d_ap_scan_now_a{0%{color:#FFFFFF}100%{color:#000000}}#d_submit{display:none;padding:5px}#d_submit_warn{text-align:center;background-color:#FFAAAA;font-weight:bold;display:none;padding:5px;border:2px solid #000000}#d_submit_exec{display:none}#d_reset_exec{display:none}
</style>
<script type="text/javascript">// <![CDATA[
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.w=e,this.d=this.w.document,this.events=[]}var e,n,s;return e=t,(n=[{key:"id",value:function(t){return this.d.getElementById(t)}},{key:"click",value:function(t,e){var n=this.id(t);return n.addEventListener("click",e),this.events.push([n,"click",e]),this}},{key:"clear_events",value:function(){for(var t in this.events){var e=this.events[t];e[0].removeEventListener(e[1],e[2])}return this.events=[],this}},{key:"show",value:function(t){return this.id(t).style.display="block",this}},{key:"hide",value:function(t){return this.id(t).style.display="none",this}},{key:"json",value:function(t,e){return new Promise((function(n,i){var s=new XMLHttpRequest;if(e?(console.log("Fetch(POST): ",t),s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")):(console.log("Fetch(GET): ",t),s.open("GET",t,!0)),s.onload=function(){this.status>=200&&this.status<400?n(JSON.parse(this.response)):i()},e){var a=[];for(var o in e){var r=e[o],u=encodeURIComponent(o)+"="+encodeURIComponent(r);a.push(u)}var d=a.join("&").replace(/%20/g,"+");s.send(d)}else s.send()}))}}])&&i(e.prototype,n),s&&i(e,s),t}();function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.u=new s(e),this.ap=[]}var e,n,i;return e=t,(n=[{key:"run",value:function(){console.log("Index"),this.ap_list_load()}},{key:"reset_disp_ap",value:function(){this.u.hide("d_ap_list").hide("d_ap_scan_now").hide("d_ap_scan").hide("d_ap_info").show("d_ap").show("m_wifi").clear_events()}},{key:"ap_list_load",value:function(){var t=this;this.reset_disp_ap(),this.u.json("/api/ap/list").then((function(e){for(var n in e.data)t.ap[n]={ssid:e.data[n].ssid,passphase:"",update:!1};t.ap_list_show()}))}},{key:"ap_list_show",value:function(){var t=this;this.reset_disp_ap();var e="<tr><td>番号</td><td>SSID</td><td>　</td></tr>",n=!1;for(var i in this.ap){var s=this.ap[i];e=e+"<tr><td>"+(new Number(i)+1)+"</td>"+(s.update?'<td style="background-color:#FFFFAA">':"<td>")+s.ssid+'</td><td><input type="button" id="b_ap_setup_'+i+'" value="設定"></td>',s.update&&(n=!0)}for(var a in this.u.id("t_ap_list").innerHTML=e,this.ap)!function(e){t.u.click("b_ap_setup_"+e,(function(n){t.ap_info_edit(e)}))}(a);this.u.click("b_submit",(function(){t.do_submit()})).click("b_clear",(function(){t.u.hide("d_submit").hide("d_submit_warn"),t.ap_list_load()})).click("b_reset",(function(){t.u.w.confirm("工場出荷時に戻します。よろしいですか？")&&t.do_reset()})),n&&this.u.show("d_submit").show("d_submit_warn"),this.u.show("d_ap_list")}},{key:"do_submit",value:function(){this.reset_disp_ap(),this.u.hide("d_submit_warn").show("d_submit_exec");var t={};for(var e in this.ap)t["ssid"+e]=this.ap[e].ssid,t["passphase"+e]=this.ap[e].passphase,t["update"+e]=this.ap[e].update?1:0;this.u.json("/api/ap/config",t)}},{key:"do_reset",value:function(){this.reset_disp_ap(),this.u.hide("d_submit_warn").show("d_reset_exec").json("/api/ap/reset",{execute_reset:42})}},{key:"ap_info_edit",value:function(t){var e=this;this.reset_disp_ap(),this.u.id("s_ap_info_num").innerHTML=new Number(t)+1,this.u.id("t_ap_info_ssid").value=this.ap[t].ssid,this.u.id("t_ap_info_passphase").value=this.ap[t].passphase,this.u.click("b_ap_info_back",(function(t){e.ap_list_show()})).click("b_ap_info_scan",(function(n){e.ap_scan_show(t)})).click("b_ap_info_commit",(function(n){var i=e.u.id("t_ap_info_ssid").value,s=e.u.id("t_ap_info_passphase").value;e.ap[t]={ssid:i,passphase:s,update:!0},e.ap_list_show()})).show("d_ap_info")}},{key:"ap_scan_show",value:function(t){var e=this;this.reset_disp_ap(),this.u.id("s_ap_scan_num").innerHTML=new Number(t)+1,this.u.show("d_ap_scan_now"),this.u.json("/api/ap/scan").then((function(n){var i="<tr><td>SSID</td><td>Ch.</td><td>RSSI</td><td></td></tr>";for(var s in n.data.sort((function(t,e){return e.rssi-t.rssi})),n.data){var a=n.data[s];i=i+"<tr><td>"+a.ssid+"</td><td>"+a.channel+"</td><td>"+a.rssi+'dB</td><td><input type="button" id="t_ap_scan_sel_'+s+'" value="選択"></tr>'}for(var o in e.u.id("t_ap_scan").innerHTML=i,n.data)!function(i){e.u.click("t_ap_scan_sel_"+i,(function(s){e.ap[t].ssid=n.data[i].ssid,e.ap[t].passphase="",e.ap_info_edit(t)}))}(o);e.u.click("b_ap_scan_back",(function(n){e.ap_info_edit(t)})).hide("d_ap_scan_now").show("d_ap_scan")}))}}])&&a(e.prototype,n),i&&a(e,i),t}();document.addEventListener("DOMContentLoaded",(function(){new s(window).json("/api/page").then((function(t){(t.page="index")&&new o(window).run()}))}))}]);
// ]]></script>


</head><body>

<div class="container">

<!-- WIFI -->
<div id="m_wifi">

<div id="d_ap">
<h1>無線LAN接続の設定</h1>

<div id="d_submit_warn">
<p>確定ボタンを押すまで反映されません</p>
</div>

<div id="d_ap_list">
<h2>アクセスポイントの設定</h2>
<p>アクセスポイントは4つまで設定できます</p>
<table id="t_ap_list"></table>

<div id="d_submit">
<input type="button" id="b_submit" value="確定">
　　　　　　
<input type="button" id="b_clear" value="クリア">
</div>

<hr>

<input type="button" id="b_reset" value="工場出荷設定">
</div>
</div>

<div id="d_ap_info">
<h2>アクセスポイントの設定 → <span id="s_ap_info_num"></span> 番</h2>
<table>
<tr><td>SSID</td><td><input type="text" id="t_ap_info_ssid" size="32" maxlength="64"></td></tr>
<tr><td>パスフレーズ</td><td><input type="text" id="t_ap_info_passphase" size="64" maxlength="64"></td></tr>
<tr><td colspan="2">
<input type="button" id="b_ap_info_back" value="戻る">
<input type="button" id="b_ap_info_scan" value="スキャン">
<input type="button" id="b_ap_info_commit" value="設定">
</td></tr>
<table>
</div>

<div id="d_ap_scan_now">
<p><blink>ただいまスキャン中！</blink></p>
</div>

<div id="d_ap_scan">
<h2>アクセスポイントの設定 → <span id="s_ap_scan_num"></span> 番 → スキャン</h2>
<p>電波の強い順番です</p>
<table id="t_ap_scan"></table>
<input type="button" id="b_ap_scan_back" value="戻る">
</div>

<div id="d_submit_exec">
<p>設定を反映しています。</p>
<p>状態LEDが1秒ごとの点滅になったら設定完了です。この端末を同じネットワークに接続して、<a href="http://esp8266.local/">http://esp8266.local/</a> にアクセスしてください。</p>
</div>

<div id="d_reset_exec">
<p>工場出荷時に戻しています。</p>
<p>しばらく待ってこのページをリロードしてください。</p>
</div>

</div>
</div>
</body>
</html>
